<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Employee Admin — Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root{
          --bg:#0f1720;
          --panel:#111827;
          --muted:#9aa8b6;
          --accent:#ff9800;
          --card:#17212a;
        }

        html,body{height:100%}
        body {
          background: linear-gradient(180deg,#08101a 0%, #0f1720 100%);
          color: #e6eef6;
          font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
          margin:0;
          padding:0;
        }

        /* Top navbar */
        .topbar{
          height:64px;
          background: linear-gradient(90deg, rgba(17,24,39,0.9), rgba(24,32,42,0.8));
          display:flex;
          align-items:center;
          padding:0 1rem;
          border-bottom: 1px solid rgba(255,255,255,0.03);
          position:sticky;
          top:0;
          z-index:1030;
        }
        .brand {
          display:flex;
          align-items:center;
          gap:.6rem;
          color:#fff;
          font-weight:600;
          letter-spacing:.2px;
        }
        .brand .logo {
          width:36px;height:36px;border-radius:6px;
          background:linear-gradient(135deg,var(--accent),#ffb366);
          display:inline-flex;align-items:center;justify-content:center;color:#111;font-weight:700;
          box-shadow:0 6px 18px rgba(255,152,0,0.12);
        }

        /* Sidebar */
        .sidebar {
          width:260px;
          height:calc(100vh - 64px);
          background: linear-gradient(180deg,#07111a,#0f1b24);
          position:fixed;
          top:64px;
          left: -280px;
          padding:18px;
          transition: left .28s ease;
          border-right:1px solid rgba(255,255,255,0.02);
          z-index:1020;
          overflow:auto;
        }
        .sidebar.open { left:0; }

        .sidebar .nav-link { color:var(--muted); font-weight:500; margin:6px 0; border-radius:8px; padding:.6rem; }
        .sidebar .nav-link:hover { color:white; background:rgba(255,255,255,0.02); }

        /* Content */
        .main {
          margin-top:64px;
          padding:24px;
          transition: margin-left .28s ease;
          margin-left:0;
        }
        .main.shifted { margin-left:260px; }

        /* card + table */
        .panel {
          background: linear-gradient(180deg,var(--card), rgba(17,24,39,0.85));
          border-radius:10px;
          padding:18px;
          border:1px solid rgba(255,255,255,0.02);
          box-shadow: 0 6px 30px rgba(2,6,23,0.6);
        }

        .table thead th { color: #cfe6ff; font-weight:600; border-bottom:1px solid rgba(255,255,255,0.04); }
        .table tbody td { vertical-align:middle; }

        /* buttons */
        .btn-accent {
          background: var(--accent);
          color:#07101a;
          font-weight:700;
          border-radius:8px;
          border:0;
        }
        .btn-accent:hover { filter:brightness(.95); }

        /* small screen behavior */
        @media (max-width: 991px) {
          .sidebar { left:-320px; width:280px; }
          .main.shifted { margin-left:0; } /* don't keep content shifted on mobile */
        }

        /* table responsiveness */
        .table-responsive {
          overflow:auto;
          -webkit-overflow-scrolling:touch;
        }

        /* subtle helper */
        .muted { color:var(--muted); font-size:0.95rem; }
        .action-btn { margin-right:6px; }
    </style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-3">
        <button id="hamburger" class="btn btn-sm btn-dark d-flex align-items-center justify-content-center" style="width:42px;height:42px;border-radius:8px">
            <i class="bi bi-list" style="font-size:20px"></i>
        </button>

        <div class="brand ms-2">
            <div class="logo">E</div>
            <div>
                <div style="font-size:14px">Employee Admin</div>
                <div class="muted" style="font-size:12px">CRUD • MySQL • Spring Boot</div>
            </div>
        </div>
    </div>

    <div class="d-flex align-items-center gap-3">
        <div class="muted d-none d-md-block">Logged in as <strong>admin</strong></div>
        <button id="addTop" class="btn btn-outline-light btn-sm">+ Add</button>
    </div>
</div>

<!-- Sidebar -->
<aside id="sidebar" class="sidebar" aria-hidden="true">
    <div class="mb-3">
        <div class="d-flex align-items-center gap-2 mb-2">
            <img src="https://api.dicebear.com/7.x/initials/svg?seed=Aditya" width="44" height="44" style="border-radius:8px" alt="avatar">
            <div>
                <div style="font-weight:700">Aditya Rai</div>
                <div class="muted" style="font-size:12px">Administrator</div>
            </div>
        </div>
        <hr style="border-color: rgba(255,255,255,0.03)">
    </div>

    <nav class="nav flex-column">
        <a class="nav-link d-flex align-items-center gap-2" href="#"><i class="bi bi-speedometer2"></i> Dashboard</a>
        <a class="nav-link d-flex align-items-center gap-2 active" href="#"><i class="bi bi-people"></i> Employees</a>
        <a class="nav-link d-flex align-items-center gap-2" href="#"><i class="bi bi-gear"></i> Settings</a>
        <a class="nav-link d-flex align-items-center gap-2" href="#"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </nav>
</aside>

<!-- Main Content -->
<main id="main" class="main container-fluid">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 style="margin:0">Employees</h3>
        <div class="d-flex gap-2">
            <input id="searchInput" class="form-control form-control-sm" placeholder="Search by name or email" style="min-width:220px">
            <button class="btn btn-outline-light btn-sm" onclick="loadEmployees()">Refresh</button>
        </div>
    </div>

    <div class="panel">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
                <strong>Employee List</strong>
                <div class="muted">Manage employees — add, edit or remove</div>
            </div>
            <div>
                <button class="btn btn-accent me-2" id="addBtn"><i class="bi bi-plus-lg"></i> New Employee</button>
                <div class="btn btn-sm btn-light" id="bulkDelete" style="display:none">Delete Selected</div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-borderless table-hover text-white align-middle">
                <thead class="small">
                <tr>
                    <th style="width:40px"><input id="selectAll" type="checkbox"></th>
                    <th style="width:80px">ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th style="width:180px">Actions</th>
                </tr>
                </thead>
                <tbody id="employeeTable"></tbody>
            </table>
        </div>

        <div class="d-flex align-items-center justify-content-between mt-3">
            <div class="muted">Showing <span id="count">0</span> employees</div>
            <nav>
                <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
            </nav>
        </div>
    </div>
</main>

<!-- Add / Edit Modal -->
<div class="modal fade" id="empModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="empModalTitle">Add Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input id="empId" type="hidden">
                <div class="mb-2">
                    <label class="form-label small">Name</label>
                    <input id="empName" class="form-control" placeholder="Full name">
                </div>
                <div class="mb-2">
                    <label class="form-label small">Email</label>
                    <input id="empEmail" class="form-control" placeholder="Email address">
                </div>
                <div class="mb-2">
                    <label class="form-label small">Department</label>
                    <input id="empDept" class="form-control" placeholder="Department">
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveEmp" type="button" class="btn btn-accent">Save</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete confirm modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-dark">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this employee?
            </div>
            <div class="modal-footer">
                <button id="confirmDeleteBtn" type="button" class="btn btn-danger">Delete</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const API = "/employees"; // backend endpoints (same origin)

    // Bootstrap modal instances
    const empModal = new bootstrap.Modal(document.getElementById('empModal'));
    const confirmDeleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));

    // state
    let employees = [];
    let currentDeleteId = null;
    let page = 1;
    const pageSize = 8;

    // DOM refs
    const tableBody = document.getElementById('employeeTable');
    const countEl = document.getElementById('count');
    const paginationEl = document.getElementById('pagination');
    const searchInput = document.getElementById('searchInput');

    // sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('main');
    document.getElementById('hamburger').addEventListener('click', () => {
      sidebar.classList.toggle('open');
      if (sidebar.classList.contains('open')) main.classList.add('shifted'); else main.classList.remove('shifted');
    });

    // open modal events
    document.getElementById('addBtn').addEventListener('click', () => openAddModal());
    document.getElementById('addTop').addEventListener('click', () => openAddModal());

    // search
    searchInput.addEventListener('input', () => { page = 1; renderTable(); });

    // load all employees from backend
    async function fetchAll() {
      const res = await fetch(API);
      if (!res.ok) return [];
      return await res.json();
    }

    async function loadEmployees() {
      employees = await fetchAll();
      renderTable();
    }

    function renderTable() {
      let list = employees.slice(); // copy

      // apply search
      const q = (searchInput.value || '').trim().toLowerCase();
      if (q) {
        list = list.filter(e => (e.name||'').toLowerCase().includes(q) || (e.email||'').toLowerCase().includes(q));
      }

      const total = list.length;
      countEl.textContent = total;

      // pagination
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      if (page > totalPages) page = totalPages;

      const start = (page - 1) * pageSize;
      const paged = list.slice(start, start + pageSize);

      // build rows
      tableBody.innerHTML = '';
      paged.forEach(emp => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" class="rowSelect" data-id="${emp.id}"></td>
          <td>${emp.id}</td>
          <td>${escapeHtml(emp.name)}</td>
          <td>${escapeHtml(emp.email)}</td>
          <td>${escapeHtml(emp.department)}</td>
          <td>
            <button class="btn btn-sm btn-outline-light action-btn" onclick="openEdit(${emp.id})"><i class="bi bi-pencil"></i> Edit</button>
            <button class="btn btn-sm btn-danger" onclick="openDelete(${emp.id})"><i class="bi bi-trash"></i> Delete</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
      paginationEl.innerHTML = '';
      for (let i=1;i<=totalPages;i++){
        const li = document.createElement('li');
        li.className = 'page-item ' + (i===page ? 'active' : '');
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.addEventListener('click', (ev) => { ev.preventDefault(); page = i; renderTable(); });
        paginationEl.appendChild(li);
      }
    }

    // open add modal
    function openAddModal(){
      document.getElementById('empModalTitle').textContent = 'Add Employee';
      document.getElementById('empId').value = '';
      document.getElementById('empName').value = '';
      document.getElementById('empEmail').value = '';
      document.getElementById('empDept').value = '';
      document.getElementById('saveEmp').dataset.mode = 'add';
      empModal.show();
    }

    // open edit modal
    function openEdit(id){
      const emp = employees.find(e => e.id === id);
      if (!emp) return alert('Employee not found');
      document.getElementById('empModalTitle').textContent = 'Edit Employee';
      document.getElementById('empId').value = emp.id;
      document.getElementById('empName').value = emp.name;
      document.getElementById('empEmail').value = emp.email;
      document.getElementById('empDept').value = emp.department;
      document.getElementById('saveEmp').dataset.mode = 'edit';
      empModal.show();
    }

    // open delete confirm
    function openDelete(id){
      currentDeleteId = id;
      confirmDeleteModal.show();
    }

    // save (add/edit)
    document.getElementById('saveEmp').addEventListener('click', async () => {
      const mode = document.getElementById('saveEmp').dataset.mode;
      const id = document.getElementById('empId').value;
      const payload = {
        name: document.getElementById('empName').value,
        email: document.getElementById('empEmail').value,
        department: document.getElementById('empDept').value
      };

      if (!payload.name || !payload.email) {
        alert('Name and email are required');
        return;
      }

      if (mode === 'add') {
        await fetch(API, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      } else {
        await fetch(`${API}/${id}`, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      }
      empModal.hide();
      await loadEmployees();
    });

    // confirm delete
    document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
      if (!currentDeleteId) return;
      await fetch(`${API}/${currentDeleteId}`, { method: 'DELETE' });
      currentDeleteId = null;
      confirmDeleteModal.hide();
      await loadEmployees();
    });

    // delete helper (from row)
    async function deleteEmployee(id){
      await fetch(`${API}/${id}`, { method: 'DELETE' });
      await loadEmployees();
    }

    // small helper: escape HTML to avoid injection
    function escapeHtml(str){
      if (!str) return '';
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    // initial load
    loadEmployees();

    // expose some functions for console/testing
    window.openEdit = openEdit;
    window.openDelete = openDelete;
    window.deleteEmployee = deleteEmployee;
    window.loadEmployees = loadEmployees;
</script>
</body>
</html>
